"""
Точка входа в программу.
"""

import argparse
import sys

from wpd.init_core import init_core


if __name__ == "__main__":
    # Настройка парсера аргументов командной строки
    parser = argparse.ArgumentParser(
        description="Отправка двух файлов и промпта в API Perplexity"
    )
    parser.add_argument("file1", nargs="?", help="Путь к первому файлу")
    parser.add_argument("file2", nargs="?", help="Путь ко второму файлу")

    args = parser.parse_args()

    # Если аргументы не указаны, запрашиваем их интерактивно
    if not args.file1:
        args.file1 = input("Введите путь к первому файлу: ").strip()
    if not args.file2:
        args.file2 = input("Введите путь ко второму файлу: ").strip()

    # Промпт для заполнения переменных в шаблоне
    prompt = (
        "Привет, ты профессиональный эксперт-методист с 15-летним стажем работы в сфере. "
        "Я прикрепляю для тебя 2 файла: шаблон Рабочей программы дисциплины от ВУЗа, а также учебные материалы. "
        "Тебе нужно заполнить шаблон Рабочей программы дисциплины, основываясь на учебных материалах, "
        "которые содержат всё, что планируется реализовать в программе на семестр. "
        "Для того, чтобы это сделать, для начала тебе нужно проанализировать шаблон и то, чего там не хватает "
        "(что нужно заполнить) (все эти места являются как бы переменными и отмечены двойными фигурными скобками, "
        "внутри них содержится краткое описание того, что там должно быть), а затем, проанализировав учебные материалы, "
        "найти те недостающие 'переменные', которые нужно заполнить в шаблоне. "
        "Ты должен выбрать и вернуть мне именно то, что непосредственно прямо указано в материалах. "
        "Те переменные, которые там не упоминаются, или которые ты не смог найти - просто пропускай и не вноси в финальный результат, "
        "который ты будешь возвращать мне. "
        "Возвращать данные мне ты должен в формате ключ:значение; ключ:значение;..., "
        "где ключ - это полное название переменной, как в шаблоне, а значение - то значение, которое ты для нее нашел. "
        "Не добавляй в ответ никакие специальные символы, разделения строк и так далее. "
        "Когда выводишь список переменных и их значений не оборачивай ключи или значения в спец символы. "
        "Символ новой строки после знака точки с запятой тоже ставить не нужно"
    )

    # Проверяем, что все параметры указаны
    if not args.file1 or not args.file2:
        print("Ошибка: Необходимо указать оба файла!")
        sys.exit(1)

    # Запускаем инициализацию ядра
    init_core(
        file1_path=args.file1,
        file2_path=args.file2,
        prompt=prompt,
        model="sonar", #"sonar", "sonar-pro"
        template_path="files/Шаблон.docx",
        result_path="files/result.docx",
    )
