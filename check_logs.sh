#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–æ–≤ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º..."
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo "1. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
docker ps | grep guap || echo "‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
echo ""

# 2. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–∑ –ª–æ–≥–æ–≤
echo "2. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ –∏–∑ –ª–æ–≥–æ–≤ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫):"
docker-compose logs --tail=50 guap | grep -i "error\|exception\|traceback\|failed" || echo "–û—à–∏–±–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å—Ç—Ä–æ–∫–∞—Ö"
echo ""

# 3. –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏
echo "3. –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫):"
docker-compose logs --tail=100 guap
echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo "4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:"
docker exec guap env | grep -E "PPLX|TELEGRAM|PORT" || echo "‚ö†Ô∏è  –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
echo ""

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤
echo "5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤:"
docker exec guap ls -la /app/files/–®–∞–±–ª–æ–Ω.docx 2>/dev/null && echo "‚úÖ –®–∞–±–ª–æ–Ω –Ω–∞–π–¥–µ–Ω" || echo "‚ùå –®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω"
docker exec guap ls -la /app/files/uploads 2>/dev/null && echo "‚úÖ –ü–∞–ø–∫–∞ uploads —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" || echo "‚ùå –ü–∞–ø–∫–∞ uploads –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
echo ""

# 6. –¢–µ—Å—Ç API –∫–ª—é—á–∞
echo "6. –¢–µ—Å—Ç API –∫–ª—é—á–∞:"
docker exec guap python3 -c "
import os
key = os.getenv('PPLX_API_KEY')
if key:
    print(f'‚úÖ PPLX_API_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–¥–ª–∏–Ω–∞: {len(key)})')
    if key.startswith('pplx-'):
        print('‚úÖ –ö–ª—é—á –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç')
    else:
        print('‚ö†Ô∏è  –ö–ª—é—á –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å pplx-')
else:
    print('‚ùå PPLX_API_KEY –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!')
" 2>/dev/null || echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–ª—é—á–∞"
echo ""

# 7. –¢–µ—Å—Ç Telegram —Ç–æ–∫–µ–Ω–∞
echo "7. –¢–µ—Å—Ç Telegram —Ç–æ–∫–µ–Ω–∞:"
docker exec guap python3 -c "
import os
token = os.getenv('TELEGRAM_BOT_TOKEN')
if token:
    print(f'‚úÖ TELEGRAM_BOT_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–¥–ª–∏–Ω–∞: {len(token)})')
else:
    print('‚ö†Ô∏è  TELEGRAM_BOT_TOKEN –ù–ï —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–±–æ—Ç –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å)')
" 2>/dev/null || echo "‚ö†Ô∏è  –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ç–æ–∫–µ–Ω–∞"
echo ""

echo "üìã –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:"
echo "   docker-compose logs -f guap"

