#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
echo ""

# –ü–æ–ª—É—á–∞–µ–º IP —Å–µ—Ä–≤–µ—Ä–∞
SERVER_IP=$(hostname -I | awk '{print $1}')
echo "IP —Å–µ—Ä–≤–µ—Ä–∞: $SERVER_IP"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo "1. –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
docker ps | grep guap && echo "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω" || echo "‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω"
echo ""

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo "2. –ü—Ä–æ–±—Ä–æ—à–µ–Ω–Ω—ã–µ –ø–æ—Ä—Ç—ã:"
docker port guap 2>/dev/null || echo "‚ö†Ô∏è  –ü–æ—Ä—Ç—ã –Ω–µ –ø—Ä–æ–±—Ä–æ—à–µ–Ω—ã"
echo ""

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo "3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
docker exec guap netstat -tuln 2>/dev/null | grep 8000 && echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8000" || echo "‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —Å–ª—É—à–∞–µ—Ç"
echo ""

# 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ö–æ—Å—Ç–µ
echo "4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ö–æ—Å—Ç–µ:"
netstat -tuln 2>/dev/null | grep 8000 && echo "‚úÖ –ü–æ—Ä—Ç 8000 –æ—Ç–∫—Ä—ã—Ç –Ω–∞ —Ö–æ—Å—Ç–µ" || echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8000 –Ω–µ —Å–ª—É—à–∞–µ—Ç—Å—è –Ω–∞ —Ö–æ—Å—Ç–µ"
echo ""

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞
echo "5. –°—Ç–∞—Ç—É—Å —Ñ–∞–π—Ä–≤–æ–ª–∞:"
if command -v ufw &> /dev/null; then
    sudo ufw status | grep 8000 && echo "‚úÖ –ü–æ—Ä—Ç 8000 –æ—Ç–∫—Ä—ã—Ç –≤ ufw" || echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8000 –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç –≤ ufw"
elif command -v firewall-cmd &> /dev/null; then
    sudo firewall-cmd --list-ports | grep 8000 && echo "‚úÖ –ü–æ—Ä—Ç 8000 –æ—Ç–∫—Ä—ã—Ç –≤ firewalld" || echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 8000 –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–∫—Ä—ã—Ç –≤ firewalld"
else
    echo "‚ö†Ô∏è  –§–∞–π—Ä–≤–æ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (ufw –∏–ª–∏ firewalld)"
fi
echo ""

# 6. –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
echo "6. –¢–µ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:"
if curl -s -o /dev/null -w "HTTP %{http_code}\n" http://localhost:8000; then
    echo "‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç"
else
    echo "‚ùå –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
fi
echo ""

# 7. –¢–µ—Å—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞
echo "7. –¢–µ—Å—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –¥–æ—Å—Ç—É–ø–∞:"
EXTERNAL_IP=$(curl -s ifconfig.me 2>/dev/null || curl -s icanhazip.com 2>/dev/null || echo "–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω")
echo "   –í–Ω–µ—à–Ω–∏–π IP: $EXTERNAL_IP"
if curl -s -o /dev/null -w "HTTP %{http_code}\n" --max-time 5 http://$SERVER_IP:8000 2>/dev/null; then
    echo "‚úÖ –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç"
    echo "   –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://$SERVER_IP:8000"
    echo "   –ò–ª–∏: http://$EXTERNAL_IP:8000"
else
    echo "‚ö†Ô∏è  –í–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Ñ–∞–π—Ä–≤–æ–ª–æ–º"
    echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π—Ä–≤–æ–ª: sudo ufw allow 8000/tcp"
    echo "   –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø —Å –¥—Ä—É–≥–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞"
fi
echo ""

echo "üìã –†–µ–∑—é–º–µ:"
echo "   –õ–æ–∫–∞–ª—å–Ω—ã–π URL: http://localhost:8000"
echo "   –í–Ω–µ—à–Ω–∏–π URL: http://$SERVER_IP:8000"
echo ""
echo "–ï—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–π –¥–æ—Å—Ç—É–ø –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "   sudo ufw allow 8000/tcp"
echo "   –∏–ª–∏"
echo "   sudo firewall-cmd --permanent --add-port=8000/tcp && sudo firewall-cmd --reload"

